<!DOCTYPE html>
<html lang="en" ng-app="Titan" class="no-js">
<head>
  <meta charset="utf-8">
  <title>Titan</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel=stylesheet href="/build/app.css">
  <style type="text/css">
    [ng-cloak], .ng-cloak {
      display: none !important;
    }
  </style>

</head>
<body layout="column" ng-controller="IndexController">
    <!-- Container #1 (see wireframe) -->
    <md-toolbar layout="row" hide-gt-sm class="ng-cloak">
      <md-button class="menu" ng-click="toggleSidebar()" >
          Menu
      </md-button>
      <h1>
        Titan
      </h1>
    </md-toolbar>

    <!-- Container #2 -->
    <div flex layout="row">

        <!-- Container #3 -->
        <md-sidenav md-is-locked-open="$mdMedia('gt-sm')"
                    md-component-id="left"
                    ng-click="ul.toggleList()" class="ng-cloak">
          <div>
            <!-- <md-icon md-svg-src="./images/titan-logo.svg" class="logo"></md-icon> -->

          </div>
          <h2>Groups</h2>
          <md-list>
            <md-list-item ng-repeat="group in groups">
              <md-button ng-click="selectGroup(group)">
                {{group.name}} <br>
                <i>Created {{group.created_at| date: 'HH:mm MM/dd/yyyy' }}</i>
              </md-button>
            </md-list-item>

            <tr >
              <td>
                <a ng-click="selectGroup(group)"></a>
                <br>

              </td>
            </tr>
          </md-list>


          <div class="col-md-2" ng-if="!selectedGroup">&nbsp;</div>


        </md-sidenav>

        <!-- Container #4 -->
        <md-content flex id="content" class="ng-cloak">
          <div class="col-md-9" ng-if="selectedGroup">
            <h2>{{selectedGroup.name}}</h2>

            <div class="btn-group" ng-if="groupJobs != null">

              <span>Jobs <b>{{currentPage * perPage + (groupJobs.length ? 1 : 0)}}-{{currentPage * perPage + groupJobs.length}}</b></span>

              <div class="btn-group pull-right">

                <button type="button" class="btn btn-default" ng-click="previousPage()" ng-class="{disabled: currentPage == 0 || isLoading}">
                  < <i class="fa fa-chevron-left"></i>&nbsp;Prev
                </button>

                <button type="button" class="btn btn-default disabled">{{currentPage + 1}}</button>

                <!-- BUG - remove +1 then fixed -->
                <button type="button" class="btn btn-default" ng-click="nextPage()" ng-class="{disabled: (groupJobs.length + 1) < perPage || isLoading}">
                  Next&nbsp;&nbsp;&nbsp;
                  <i class="fa fa-chevron-right"></i> >
                </button>
              </div>
            </div>


            <div ng-if="groupJobs == null">loading ....</div>

            <table class="table" ng-if="groupJobs != null">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Status</th>
                  <th>Image</th>
                  <th title="Priority">Pr</th>
                  <th>payload</th>
                  <th>Created</th>
                  <th>Started</th>
                  <th>Completed</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="job in groupJobs">
                  <td>{{job.id}}</td>
                  <td>
                    <span ng-if="job.status != 'error'">{{job.status}}</span>
                    <a ng-if="job.status == 'error'" ng-click="showError($event, job)">error</a>
                    </td>
                  <td>{{job.image}}</td>
                  <td>{{job.priority}}</td>
                  <td>
                    <a ng-click="showPayload($event, job)">payload</a>
                  </td>
                  <td>{{job.created_at| date: 'HH:mm MM/dd/yyyy'}}</td>
                  <td>{{job.started_at| date: 'HH:mm MM/dd/yyyy'}}</td>
                  <td>{{job.completed_at| date: 'HH:mm MM/dd/yyyy'}}</td>
                  <td>
                    <a class="btn btn-danger" ng-click="cancelJob(job)" ng-if="job.status == 'queued' || job.status == 'running' || job.status == 'delayed'">cancel</a>
                    <a class="btn btn-danger" ng-click="retryJob(job)" ng-if="job.status == 'cancelled' || job.status == 'error' || job.status == '??'">retry</a>
                  </td>
                </tr>

                <tr ng-if="groupJobs.length == 0">
                  <td colspan="99">
                    No Jobs
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

        </md-content>

    </div>



  <script src="/build/app.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc4/angular-material.min.js"></script>
</body>
</html>
